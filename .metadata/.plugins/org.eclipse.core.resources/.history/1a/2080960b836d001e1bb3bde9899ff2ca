<%@page import="com.oreilly.servlet.multipart.DefaultFileRenamePolicy"%>
<%@page import="com.oreilly.servlet.MultipartRequest"%>
<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%
   request.setCharacterEncoding("UTF-8");  //인코딩
   
   //<form enctype="multipart/form-data">를 적용하면, 인코딩 방식이 변경된다.
   //1. request.getParameter() 이 동작 불능!
   //2. request.getParameterValues() 이 동작 불능!
   //String name=request.getParameter("name");
   //String age=request.getParameter("age");
   
   //그럼 해결책은?
   //cos-jar -> MultipartRequest 클래스 -> 객체가 request의 수신 기능을 대신한다.
   //그냥은 못만들고 준비물이 필요 -> 업로드된 파일을 어디에 저장할 경로 -> 로컬경로 필요(C:\..)
   //- C:\class\code\server\JSPTest\src\main\webapp\<files></files>
   
   // 첫번째 준비물 -> 절대 경로를 (상대경로) 입력하면 로컬 경로로 변환해준다.
   String path=application.getRealPath("/files");   // '/' 는 webapp를 의미.
   //System.out.println(path);  //C:\class\code\server\.metadata\.plugins\org.eclipse.wst.server.core\tmp0\wtpwebapps\JSPTest\files
   
   //2. 업로드 파일의 최대 크기를 지정해줘야 한다.(바이트 단위로)
   int size=1024*1024*100;  //100MB
   
   //3. 변수 선언
   String name="";  //이름
   String age="";   //나이
   String filename="";   //첨부파일명
   String orgfilename="";  //첨부파일명
   
   //4. request -> MultipartRequest -> 객체 생성
   try{
      //MultipartRequest 객체를 만드는 순간 -> 이미 첨부파일은 files 복사가 완료된다.
      MultipartRequest multi=new MultipartRequest(request, path, size, "UTF-8", new DefaultFileRenamePolicy());  //원래 입력값이 첫번째, path가 두번째 매개변수 위치에.
      // 파일명을 관리하면서 중복이 생기면 넘버링을 한다.
      
      //데이터 수신
      //name=request.getParameter("name")   //동작x
      name=multi.getParameter("name");   //동작o
      age=multi.getParameter("age");
      
      //업로드 한 파일 정보 -> 파일명 
      //- <input type="file" name="attach">
      filename=multi.getFilesystemName("attach");  //파일명
      orgfilename=multi.getOriginalFileName("attach");  //파일명
      
      
   }catch(Exception e){
      e.printStackTrace();
   }
   
%>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<link rel="stylesheet" href="http://pinnpublic.dothome.co.kr/cdn/example-min.css">
<style>

</style>
</head>
<body>
   <h1>결과</h1>
   
   <div>
      이름 : <%= name %>
   </div>
   <div>
      나이 : <%= age %>
   </div>
   <div>
      파일명 : <%= filename %>
   </div>
   <div>
      파일명 : <%= orgfilename %>
   </div>
   
   <h2>파일 다운로드</h2>

   <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
   <script src="http://pinnpublic.dothome.co.kr/cdn/example-min.js"></script>
   <script>
   
   </script>

</body>
</html>